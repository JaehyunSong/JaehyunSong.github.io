<!DOCTYPE html>
<html lang="ja-jp">
    <head>
        <script defer src="/fa/fontawesome-all.js"></script>
        

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Rによる無作為配分のシミュレーション</title>
        
        <style>

    html body {
        font-family: 'Noto Sans JP', sans-serif;
        background-color: white;
    }

    :root {
        --accent: darkred;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://www.jaysong.net/css/main.css">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto%20Sans%20JP">


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/R.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/php.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/html.min.js"></script>
    
    <script>hljs.initHighlightingOnLoad();</script>






<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.84.2" />
        

        
            <script async src="https://www.googletagmanager.com/gtag/js?id=UA-96999602-1"></script>
            <script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments)};
              gtag('js', new Date());
              gtag('config', 'UA-96999602-1');
              gtag('set', {'user_id': 'USER_ID'});
            </script>

            <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-96999602-1', 'auto');
                ga('send', 'pageview');
            </script>
        

        <meta name="google-site-verification" content="QJouPRaPKBPU1jDp6VaBuFbVV5imTI-Aazl_ScJwVgU" />

        
            <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        

        

    </head>

    <body>
        

        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand visible-xs" href="#">Rによる無作為配分のシミュレーション</a>
                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse">
                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/">Home</a></li>
                            
                                <li><a href="/about/">CV</a></li>
                            
                                <li><a href="/research/">Research</a></li>
                            
                                <li><a href="/teaching/">Teaching</a></li>
                            
                                <li><a href="/seminar/">Seminar</a></li>
                            
                                <li><a href="/software/">Software</a></li>
                            
                                <li><a href="/notes/">Notes</a></li>
                            
                                <li><a href="/tutorial/">Tutorial</a></li>
                            
                        </ul>
                    
                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="mailto:song@kansai-u.ac.jp"><i class="far fa-envelope"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/Tintstyle/"><i class="fab fa-twitter"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.facebook.com/tintstyle"><i class="fab fa-facebook"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.instagram.com/tintstyle/"><i class="fab fa-instagram"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/JaehyunSong/"><i class="fab fa-github"></i></a></li>
                            
                        </ul>
                    
                </div>
            </div>
        </nav>


<main>

    <div>
        <h2><center>Rによる無作為配分のシミュレーション</center></h2>
        <h5><center></center></h5>
        <center>
<a href="https://www.jaysong.net/tags/%E3%82%B7%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"><kbd class="item-tag">シミュレーション</kbd></a>

</center>
    </div>

    <div align="start" class="content">
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>このシミュレーションの目的は一つのグループに何人くらい配分したら全体の平均値に近づくのかを経験的に確認するためのものです。</p>
<p>趣味でしたものなので授業とは全く関係ありません。Rを覚える必要もありません。理解しなくてもいいです。Rを触ったことがないと、何をやってるのか分からないと思うので読まなくてもいいです。</p>
<p>それでは、さっそく</p>
<p>作図のためにggplot2パッケージの呼び出す。もし、ggplot2がR上にない場合、まず<code>install.packages("ggplot2")</code>でインストールしておく。</p>
<pre class="r"><code>library(ggplot2)</code></pre>
<p>次に実験群の数<code>n.group</code>を設定する。ここでは統制群, 実験群1, 実験群2ということで3に設定</p>
<pre class="r"><code>n.group &lt;- 3</code></pre>
<p>続いて、シミュレーション結果を保存するデータフレームの作成する。</p>
<pre class="r"><code>result.df &lt;- data.frame(n           = rep(NA, 996),
                        sex.mean    = rep(NA, 996),
                        age.mean    = rep(NA, 996),
                        trust.mean  = rep(NA, 996),
                        n1          = rep(NA, 996),
                        n2          = rep(NA, 996),
                        n3          = rep(NA, 996),
                        sex.mean1   = rep(NA, 996),
                        sex.mean2   = rep(NA, 996),
                        sex.mean3   = rep(NA, 996),
                        age.mean1   = rep(NA, 996),
                        age.mean2   = rep(NA, 996),
                        age.mean3   = rep(NA, 996),
                        trust.mean1 = rep(NA, 996),
                        trust.mean2 = rep(NA, 996),
                        trust.mean3 = rep(NA, 996))</code></pre>
<p>本格的にシミュレーションコードを書いてみる。一つの実験群に理論的に5から1000まで入るようにする。つまり、サンプルサイズは15から3000まで3ずつ増やしていく。</p>
<pre class="r"><code>for (i in 5:1000){
  # 架空のデータセットの生成する
  # 各グループに大体x人が属し、３つのグループで分けるなら
  # xの3倍のサンプルサイズが必要
  sex   &lt;- sample(0:1,   i * n.group, replace = TRUE)
  age   &lt;- sample(20:70, i * n.group, replace = TRUE)
  trust &lt;- sample(1:5,   i * n.group, replace = TRUE)

  # グループを分ける
  group.id &lt;- sample(1:n.group, i * n.group, replace = TRUE)

  # 架空データセットをデータフレームとして保存
  temp.df &lt;- data.frame(sex, age, trust, group.id)

  # サンプルサイズ
  sample.size &lt;- i * n.group

  # サンプル全体のsex, age, trustの平均値
  sex.mean   &lt;- mean(temp.df$sex  )
  age.mean   &lt;- mean(temp.df$age  )
  trust.mean &lt;- mean(temp.df$trust)

  # 各グループにいくつのケースが属されているかを計算
  n1 &lt;- nrow(subset(temp.df, group.id == 1))
  n2 &lt;- nrow(subset(temp.df, group.id == 2))
  n3 &lt;- nrow(subset(temp.df, group.id == 3))

  # 各グループごとのsex, age, trustの平均値を計算する
  sex.mean1 　&lt;- mean(subset(temp.df, group.id == 1)$sex  )
  sex.mean2   &lt;- mean(subset(temp.df, group.id == 2)$sex  )
  sex.mean3   &lt;- mean(subset(temp.df, group.id == 3)$sex  )
  age.mean1   &lt;- mean(subset(temp.df, group.id == 1)$age  )
  age.mean2   &lt;- mean(subset(temp.df, group.id == 2)$age  )
  age.mean3   &lt;- mean(subset(temp.df, group.id == 3)$age  )
  trust.mean1 &lt;- mean(subset(temp.df, group.id == 1)$trust)
  trust.mean2 &lt;- mean(subset(temp.df, group.id == 2)$trust)
  trust.mean3 &lt;- mean(subset(temp.df, group.id == 3)$trust)

  # 結果を保存
  result.df[i-4, ] &lt;- c(sample.size, sex.mean, age.mean, trust.mean,
                        n1, n2, n3,
                        sex.mean1, sex.mean2, sex.mean3,
                        age.mean1, age.mean2, age.mean3,
                        trust.mean1, trust.mean2, trust.mean3)
}</code></pre>
<p>結果をグラフで確認してみる。</p>
<p>まず、各グループにちゃんと3分の1ずつ割り当てられているかをみる。赤の実線は3分の1を表し、この実線に近いということは理想的に割り当てられていることを意味する。</p>
<pre class="r"><code># 各グループにちゃんと1/3ずつ入ったかを確認。
# 赤の実線に近いほど理想的な割合で配分されたということ
ggplot(data = result.df) +
  geom_line(aes(x = n, y = n1/n, color = &quot;red&quot;),   alpha = 0.4) +
  geom_line(aes(x = n, y = n2/n, color = &quot;blue&quot;),  alpha = 0.4) +
  geom_line(aes(x = n, y = n3/n, color = &quot;green&quot;), alpha = 0.4) +
  geom_hline(yintercept = 1/3, color = &quot;red&quot;) +
  geom_vline(xintercept = 750, color = &quot;red&quot;) +
  scale_color_discrete(name = &quot;Group&quot;,
                       labels = c(&quot;Group1&quot;, &quot;Group3&quot;, &quot;Group2&quot;)) +
  labs(x = &quot;Sample size&quot;, y = &quot;Sample size in each group&quot;) +
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<p><img src="/simulation/2015-05-21-Random_Assignment_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>だいたいサンプルサイズが500~750くらいになると3つのグループは概ね3分の1ずつ割り当てられることが確認できる。</p>
<p>次は、割り当てられたグループの性別の平均値が均一か否かをみる。紫を除く3つの線が集まっていると3つのグループの性別の平均値は概ね一緒ということを意味する。赤い実線は理論値である0.5を表すが、そもそもサンプルの平均が0.5になっているという保障はないので注意が必要。</p>
<pre class="r"><code># 各グループのsex, age, trustの平均値。
# 紫(?)は全体の平均値
# 赤い実線は理論値
ggplot(data = result.df) +
  geom_line(aes(x = n, y = sex.mean,  color = &quot;black&quot;), alpha = 0.4) +
  geom_line(aes(x = n, y = sex.mean1, color = &quot;red&quot;),   alpha = 0.4) +
  geom_line(aes(x = n, y = sex.mean2, color = &quot;blue&quot;),  alpha = 0.4) +
  geom_line(aes(x = n, y = sex.mean3, color = &quot;green&quot;), alpha = 0.4) +
  geom_hline(yintercept = 0.5, color = &quot;red&quot;) +
  geom_vline(xintercept = 750, color = &quot;red&quot;) +
  scale_color_discrete(name = &quot;Group&quot;,
                       labels = c(&quot;Group1&quot;, &quot;Group3&quot;, &quot;Group2&quot;, &quot;Entire&quot;)) +
  labs(x = &quot;Sample size&quot;, y = &quot;Mean of Sex&quot;) +
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<p><img src="/simulation/2015-05-21-Random_Assignment_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>サンプルサイズが大きくなると紫を除く3つの線は赤い実線に集まっていくことが確認できる。ただし、サンプルサイズが15(最小値)から600に変化したときと1000から3000に変化した時の差をみると明らかに前者の方の差が大きい。つまり、3つのグループで、0/1変数の場合はサンプルサイズがだいたい500、つまり一つのグループに170人くらいいるとグループ間の均質性は保証され、そこからは劇的にサンプルサイズを増やさないかぎり、大きな変化はないと考えられる。</p>
<p>同じ手順で<code>age</code>と<code>trust</code>も見てみよう。</p>
<pre class="r"><code>ggplot(data = result.df) +
  geom_line(aes(x = n, y = age.mean,  color = &quot;black&quot;), alpha = 0.4) +
  geom_line(aes(x = n, y = age.mean1, color = &quot;red&quot;),   alpha = 0.4) +
  geom_line(aes(x = n, y = age.mean2, color = &quot;blue&quot;),  alpha = 0.4) +
  geom_line(aes(x = n, y = age.mean3, color = &quot;green&quot;), alpha = 0.4) +
  geom_hline(yintercept = 45, color = &quot;red&quot;) +
  geom_vline(xintercept = 750, color = &quot;red&quot;) +
  scale_color_discrete(name = &quot;Group&quot;,
                       labels = c(&quot;Group1&quot;, &quot;Group3&quot;, &quot;Group2&quot;, &quot;Entire&quot;)) +
  labs(x = &quot;Sample size&quot;, y = &quot;Mean of Age&quot;) +
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<p><img src="/simulation/2015-05-21-Random_Assignment_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = result.df) +
  geom_line(aes(x = n, y = trust.mean,  color = &quot;black&quot;), alpha = 0.4) +
  geom_line(aes(x = n, y = trust.mean1, color = &quot;red&quot;),   alpha = 0.4) +
  geom_line(aes(x = n, y = trust.mean2, color = &quot;blue&quot;),  alpha = 0.4) +
  geom_line(aes(x = n, y = trust.mean3, color = &quot;green&quot;), alpha = 0.4) +
  geom_hline(yintercept = 3, color = &quot;red&quot;) +
  geom_vline(xintercept = 750, color = &quot;red&quot;) +
  scale_color_discrete(name = &quot;Group&quot;,
                       labels = c(&quot;Group1&quot;, &quot;Group3&quot;, &quot;Group2&quot;, &quot;Entire&quot;)) +
  labs(x = &quot;Sample size&quot;, y = &quot;Mean of Trust&quot;) +
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<p><img src="/simulation/2015-05-21-Random_Assignment_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<p>結果的にみると一つのグループに250人くらい割り当てられるサンプルサイズ(ここではグループは3つだから750人くらい)で、各グループのサンプルサイズと各変数の期待値がある程度安定することが確認できる。</p>
<p>もしかしたら、測定質問の尺度(つまり、分散)と関係があるかも知れない。二項変数 (<code>sex</code>) やカテゴリ変数 (<code>trust</code>) は確かにN = 500、つまりグループごとに166人くらいで安定するように見えるが、連続変数 (<code>age</code>) は250人くらいだと思う。尺度の最小値の最大値の幅が広いと分散が大きくなるせいではないかとも思う。これに関しては尺度の分散をいじりながらシミュレーションしてみる価値があるかも。</p>
</div>

</main>

        <footer>
            <p class="copyright text-muted" align = "center">© All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a>. Customized by <a href="https://www.jaysong.net">Jaehyun Song</a></p>
        </footer>

        

        
    </body>

</html>

